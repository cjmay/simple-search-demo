# This docker-compose application stands up the following services:
#   - a webserver on port 8080
#   - a FetchCommunicationService on port 9090
#   - a SearchService on port 9091


version: "3"

volumes:
  index_volume:

services:

  # Servers

  fetch:
    image: hltcoe/concrete-python
    command: fetch-server.py --loglevel debug /home/concrete/simple-search/files/comms.zip
    ports:
      - "9090:9090"
    volumes:
      - .:/home/concrete/simple-search/files/

#   # If you want to use the WikiQA corpus, comment out the 'fetch' configuration
#   # section above, and uncomment the two lines below:
#   fetch:
#     image: hltcoe/fetch-wikiqa-corpus

  # Build a Lucene index from the Communications in the Fetch server
  build-search-index.cmd:
    depends_on:
      - fetch
    image: hltcoe/cadet-search-lucene
    command: -d /index_dir/ --fh fetch --fp 9090 --build-index --batch 10
    volumes:
      - index_volume:/index_dir
